<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Lecture Data Editor (MVC)</title>
    <style>
        :root {
            --primary: #54a0ff;
            --bg: #1e272e;
            --card-bg: #2d3436;
            --text: #f5f6fa;
            --danger: #ff4757;
            --success: #2ecc71;
        }

        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .editor-container { max-width: 1200px; margin: 0 auto; }
        .toolbar { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 10px; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; font-size: 0.9rem; }
        th { background: #3d4446; color: var(--primary); }
        tr:hover { background: rgba(255,255,255,0.05); }

        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; }
        .btn-save { background: var(--success); color: white; }
        .btn-edit { background: #f1c40f; color: #2d3436; margin-right: 5px; }
        .btn-del { background: var(--danger); color: white; }

        /* Modal Style */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-content { background: var(--card-bg); width: 500px; margin: 50px auto; padding: 30px; border-radius: 12px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #aaa; }
        .form-group input, .form-group select { width: 100%; padding: 8px; background: #3d4446; border: 1px solid #555; color: white; border-radius: 4px; box-sizing: border-box;}

        #json-output { width: 100%; height: 200px; margin-top: 20px; background: #000; color: #0f0; font-family: monospace; padding: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="editor-container">
    <h2>ğŸ“… ê°•ì˜ ë°ì´í„° ë§ˆìŠ¤í„° ì—ë””í„°</h2>
    
    <div class="toolbar">
        <div>
            <button class="btn btn-add" onclick="controller.handleOpenAddModal()">â• ê°•ì˜ ì¶”ê°€</button>
            <button class="btn btn-save" onclick="controller.handleExportJSON()">ğŸ’¾ JSON ì¶”ì¶œ (data.jsìš©)</button>
        </div>
        <div>
            <select id="data-source-type" onchange="controller.handleSourceChange(this.value)" style="padding: 8px; background: #3d4446; color: white; border-radius: 4px;">
                <option value="weekday">í‰ì¼ ë°ì´í„° (data.js)</option>
                <option value="weekend">ì£¼ë§ ë°ì´í„° (dataWeekEnd.js)</option>
            </select>
        </div>
    </div>

    <table id="lecture-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>ê°•ì˜ì‹¤</th>
                <th>ê³¼ëª©ëª…</th>
                <th>ê°•ì‚¬</th>
                <th>ì‹œê°„</th>
                <th>ìš”ì¼</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>ì‘ì—…</th>
            </tr>
        </thead>
        <tbody id="lecture-list"></tbody>
    </table>

    <textarea id="json-output" readonly placeholder="ì¶”ì¶œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— JSON ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
</div>

<div id="editor-modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">ê°•ì˜ ì •ë³´ ìˆ˜ì •</h3>
        <form id="lecture-form">
            <input type="hidden" id="f-id">
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;">
                    <label>ê°•ì˜ì‹¤</label>
                    <input type="text" id="f-room" placeholder="M, O, P..." required>
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>ê³¼ëª©ëª…</label>
                    <input type="text" id="f-subject" required>
                </div>
            </div>
            <div class="form-group">
                <label>ê°•ì‚¬</label>
                <input type="text" id="f-instructor" required>
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group">
                    <label>ì‹œì‘(H)</label>
                    <input type="number" id="f-startH" min="9" max="22" required>
                </div>
                <div class="form-group">
                    <label>ì¢…ë£Œ(H)</label>
                    <input type="number" id="f-endH" min="9" max="22" required>
                </div>
                <div class="form-group">
                    <label>ìš”ì¼</label>
                    <input type="text" id="f-days" placeholder="ì›”~ê¸ˆ, í† /ì¼" required>
                </div>
            </div>
            <div class="form-group">
                <label>ê¸°ê°„ ì •ë³´</label>
                <input type="text" id="f-dateInfo" placeholder="MM-DD ~ MM-DD">
            </div>
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬ (CSS í´ë˜ìŠ¤ëª…)</label>
                <select id="f-category">
                    <option value="prog-adv">prog-adv (í”„ë¡œê·¸ë˜ë° ì‹¬í™”)</option>
                    <option value="art-adv">art-adv (ì›í™” ì‹¬í™”)</option>
                    <option value="art-basic">art-basic (ê¸°ì´ˆì•„íŠ¸ì›)</option>
                    <option value="webtoon">webtoon (ì›¹íˆ°)</option>
                    <option value="plan-adv">plan-adv (ê¸°íš)</option>
                    <option value="graphic">graphic (ê·¸ë˜í”½)</option>
                    <option value="kdigital">kdigital (êµ­ë¹„)</option>
                    <option value="port">port (í¬íŠ¸í´ë¦¬ì˜¤)</option>
                </select>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button type="button" class="btn" onclick="controller.handleCloseModal()">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-add">ì €ì¥í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>

<script src="data.js"></script>
<script>
/**
 * 1. MODEL
 */
const model = {
    data: [],
    
    init() {
        // ì´ˆê¸° ë¡œë“œ ì‹œ LECTURE_DATA (data.js) ì‚¬ìš©
        this.data = typeof LECTURE_DATA !== 'undefined' ? [...LECTURE_DATA] : [];
    },

    getAll() { return this.data; },

    getById(id) { return this.data.find(l => l.id == id); },

    remove(id) {
        this.data = this.data.filter(l => l.id != id);
    },

    save(formData) {
        if (formData.id) {
            // Update
            const index = this.data.findIndex(l => l.id == formData.id);
            this.data[index] = { ...this.data[index], ...formData };
        } else {
            // Create
            const newId = this.data.length > 0 ? Math.max(...this.data.map(d => d.id)) + 1 : 1;
            this.data.push({ ...formData, id: newId });
        }
    }
};

/**
 * 2. VIEW
 */
const view = {
    renderList(list) {
        const tbody = document.getElementById('lecture-list');
        tbody.innerHTML = list.map(item => `
            <tr>
                <td>${item.id}</td>
                <td><b style="color:var(--primary)">${item.room}</b></td>
                <td>${item.subject}</td>
                <td>${item.instructor}</td>
                <td>${item.startH}:00 - ${item.endH}:00</td>
                <td>${item.days}</td>
                <td><span class="bg-${item.category}" style="padding:2px 6px; border-radius:4px; font-size:11px;">${item.category}</span></td>
                <td>
                    <button class="btn btn-edit" onclick="controller.handleOpenEditModal(${item.id})">ìˆ˜ì •</button>
                    <button class="btn btn-del" onclick="controller.handleDelete(${item.id})">ì‚­ì œ</button>
                </td>
            </tr>
        `).join('');
    },

    showModal(lecture = null) {
        const modal = document.getElementById('editor-modal');
        const form = document.getElementById('lecture-form');
        document.getElementById('modal-title').innerText = lecture ? 'ê°•ì˜ ì •ë³´ ìˆ˜ì •' : 'ìƒˆ ê°•ì˜ ì¶”ê°€';
        
        if (lecture) {
            document.getElementById('f-id').value = lecture.id;
            document.getElementById('f-room').value = lecture.room;
            document.getElementById('f-subject').value = lecture.subject;
            document.getElementById('f-instructor').value = lecture.instructor;
            document.getElementById('f-startH').value = lecture.startH;
            document.getElementById('f-endH').value = lecture.endH;
            document.getElementById('f-days').value = lecture.days;
            document.getElementById('f-dateInfo').value = lecture.dateInfo;
            document.getElementById('f-category').value = lecture.category;
        } else {
            form.reset();
            document.getElementById('f-id').value = '';
        }
        modal.style.display = 'block';
    },

    closeModal() {
        document.getElementById('editor-modal').style.display = 'none';
    },

    renderExport(jsonString) {
        const out = document.getElementById('json-output');
        out.value = `const LECTURE_DATA = ${jsonString};`;
        out.select();
        alert("JSON ë°ì´í„°ê°€ í•˜ë‹¨ í…ìŠ¤íŠ¸ ë°•ìŠ¤ì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë³µì‚¬í•˜ì—¬ data.jsì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
    }
};

/**
 * 3. CONTROLLER
 */
const controller = {
    init() {
        model.init();
        view.renderList(model.getAll());

        // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë°”ì¸ë”©
        document.getElementById('lecture-form').onsubmit = (e) => {
            e.preventDefault();
            this.handleSave();
        };
    },

    handleOpenAddModal() {
        view.showModal();
    },

    handleOpenEditModal(id) {
        const lecture = model.getById(id);
        view.showModal(lecture);
    },

    handleCloseModal() {
        view.closeModal();
    },

    handleSave() {
        const formData = {
            id: document.getElementById('f-id').value,
            room: document.getElementById('f-room').value,
            subject: document.getElementById('f-subject').value,
            instructor: document.getElementById('f-instructor').value,
            startH: parseInt(document.getElementById('f-startH').value),
            endH: parseInt(document.getElementById('f-endH').value),
            days: document.getElementById('f-days').value,
            dateInfo: document.getElementById('f-dateInfo').value,
            category: document.getElementById('f-category').value,
            weekType: "ALL", // ê¸°ë³¸ê°’
            isBadge: ""
        };
        
        model.save(formData);
        view.renderList(model.getAll());
        view.closeModal();
    },

    handleDelete(id) {
        if (confirm(`${id}ë²ˆ ê°•ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            model.remove(id);
            view.renderList(model.getAll());
        }
    },

    handleExportJSON() {
        const data = model.getAll();
        const json = JSON.stringify(data, null, 2);
        view.renderExport(json);
    },

    handleSourceChange(val) {
        alert("ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë³€ê²½í•˜ë ¤ë©´ í•´ë‹¹ js íŒŒì¼ì´ ë¡œë“œë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ëŠ” ë°ëª¨ë¥¼ ìœ„í•´ data.js ê¸°ì¤€ ë™ì‘)");
    }
};

// ì•± ì‹œì‘
window.onload = () => controller.init();
</script>

</body>
</html>